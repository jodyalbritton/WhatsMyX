$('#no_comments').hide();
<% if @comment.valid? %>
  <% if @reply %>
    if($('#comment_<%= @comment.commentable_id %> ul').length == 0)
      $('#comment_<%= @comment.commentable_id %>').append('<ul id="comment_<%= @comment.commentable_id %>_replies" class="replies"></ul>');
    $('#comment_<%= @comment.commentable_id %>_replies').append("<%= escape_javascript( render @comment, :locals => {:reply => @reply} ) %>");
    $('#commentable_id').val('<%= @comment.commentable.commentable_id %>');
    $('#commentable_type').val('<%= @comment.commentable.commentable_type %>');
  <% else %>
     /*Hide the div post_errors*/
  $("#flash_notice").hide(300);

  /*Update the html of the div flash_notice with the new one*/
  $("#flash_notice").append("<%= escape_javascript(flash[:notice])%>");

  /*Show the flash_notice div*/
  $("#flash_notice").show(300);

  $('#comments_<%= @comment.commentable_id %>').<%= Opinio.sort_order == 'ASC' ? 'append' : 'prepend'%>("<%= escape_javascript( render @comment, :locals => {:reply => @reply} ) %>");
  <% end %>
  
  $('textarea#comment_body').val('');
  
<% else %>

  $('#flash_error').append("<%= escape_javascript(flash[:error]) %>");
<% end %>
